title: "Essay Grammar Checker"
description: >
  Essay Grammar Checker trained on Russian Error-Annotated Learner English Corpus (REALEC).

vars:
  config: "default"
  lang: "en"
  corpus: "realec"
  train_name: "train"
  dev_name: "dev"
  package_name: "grammar_checker"
  package_version: "2.0.0"
  gpu: 0

directories: ["metrics", "configs", "training", "packages"]

assets:
  - dest: '${vars.corpus}/train.spacy'
workflows:
  all:
    - preprocess
    - generate_configs
    - train_pipelines
    - evaluate_pipelines
    - assemble_pipelines
    - package
commands:
  - name: preprocess
    help: "Compute class weights and labels for the SpaCy configuration file format required for the SpanCategorizer component."
    script:
      - python scripts/spans_to_dict.py ${vars.corpus} ${vars.lang}
    deps: 
      - "${vars.corpus}/train.spacy"
  - name: generate_configs
    help: "Fill configuration file for training."
    script:
      - "python scripts/generate_configs.py configs/default.cfg ${vars.corpus}"
    deps:
      - "${vars.corpus}"   
      - "configs/default.cfg"
  - name: train_pipelines
    help: "Training"
    script:
      - sh scripts/train.sh
  - name: evaluate_pipelines
    help: "Evaluate pipelines"
    script:
      - sh scripts/evaluate.sh
  - name: assemble_pipelines
    help: "Add a trained component as a new language factory"
    script:
      - sh scripts/save_configs.sh
      - "python scripts/assemble_pipelines.py grammar_checker_nlp"
  - name: package
    help: "Package an assembled model"
    script:
      - "python -m spacy package grammar_checker_nlp packages --name ${vars.package_name} --version ${vars.package_version} --code scripts/custom_factories.py --force --build wheel"
    deps:
      - "grammar_checker_nlp"

    

